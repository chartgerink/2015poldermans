---
title: "Analyzing DECREASE trials for extent of data fabrication"
author: "Chris HJ Hartgerink, Gerben ter Riet, Marleen Kemper"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: word_document
csl: ../bibliography/ama.csl
bibliography: ../bibliography/library.bib
---

The effectiveness of beta-blockers in preventing perioperative mortatility in non-cardiac surgery has been subject of discussion due to findings of misconduct. [@commissie2011;@commissie2012;@commissie2013;@bouri2014]. Perioperative mortality is the deathrate of patients during the period of the surgical procedure, typically including admission, anaesthesia, surgery, and recovery. 

The trials that were found to be suspect were the DECREASE trials [@commissie2011;@commissie2012;@commissie2013]. Upon being discovered as (potentially) fabricated, the DECREASE studies were excluded from a 2014 meta-analysis [@bouri2014]. The corrected analyses found that conclusions on the effectiveness of beta-blockers in perioperative mortality were reversed --- beta-blockers seemed to actually *increase* perioperative mortality instead of decrease it.

The committee reports about the DECREASE studies indicate that data fabrication was likely [@commissie2011;@commissie2012;@commissie2013], but the extent of the data fabrication was not clearly indicated or deemed estimable. In this paper, we aim to estimate the extent of data fabrication in the DECREASE studies [@dunkelgrun2009;@poldermans1999]. We expect to confirm the conclusions of the reports that data fabrication is likely.

To investigate the evidence for data fabrication in the DECREASE studies [@dunkelgrun2009;@poldermans1999], we take three steps. First, we try to replicate the findings from the 2014 meta-analysis [@bouri2014], which should be possible with the trial-event data provided in this meta-analysis. Second, we evaluate the veracity of the DECREASE studies (i.e., the probability that these study findings occurred assuming no data fabrication occurred). Third, we reverse this assumption and assume that data fabrication did occur and estimate how many data points would have to be fabricated to reproduce the results of the DECREASE studies. We expand on the methods for these three steps below.

# Step 1: reproducing Bouri et al. (2014)

In order to ensure we are using similar analytic procedures as in the 2014 meta-analysis [@bouri2014], we initially reproduce the estimates. This ensured that (1) their results are reproducible and (2) we are using the correct estimates in the following steps. In order to replicate the results of the meta-analysis, we extract the trial-event data available from figures 2 and 3 in the original paper[@bouri2014]. More specifically, we extract the raw trial-event data for the 2 (control vs experimental) by 2 (event or no event) design, which we use to recompute the natural logarithm of the risk ratio and its standard error. The extracted trial-event data is available at osf.io/aykeh and our analysis plan was preregistered at osf.io/vnmzc.

## Method

```{r, echo = FALSE}
suppressPackageStartupMessages(if(!require(metafor)){install.package('metafor')})
suppressPackageStartupMessages(library(metafor))

bouri_data <- read.csv('../data/bouri_data.csv')

bouri_data$a <- bouri_data$control_n - bouri_data$control_events
bouri_data$b <- bouri_data$beta_n - bouri_data$beta_events
bouri_data$c <- bouri_data$control_events
bouri_data$d <- bouri_data$beta_event

# Add .5 to studies with zero-counts
bouri_data[c(4, 7, 9), 7:10] <-  bouri_data[c(4, 7, 9), 7:10] + .5

bouri_data$ln_rr <- log((bouri_data$d/(bouri_data$b+bouri_data$d))/(bouri_data$c/(bouri_data$a+bouri_data$c)))
bouri_data$se_ln_rr <- sqrt((1/bouri_data$a)+(1/bouri_data$b)+(1/bouri_data$c)+(1/bouri_data$d))

mod_clean <- metafor::rma(yi = ln_rr,
             sei = se_ln_rr,
             method = "REML",
             data = bouri_data[bouri_data$decrease == 0, ],
             weighted = TRUE)
mod_dirty <- metafor::rma(yi = ln_rr,
             sei = se_ln_rr,
             method = "REML",
             data = bouri_data[bouri_data$decrease == 1, ],
             weighted = TRUE)
```

We computed the risk ratio (RR) for each study and meta-analyzed the effects. We used the `R` package `metafor` [@viechtbauer2010] to meta-analyze the RRs. We estimated a weighted random-effects model using the restricted maximum-likelihood estimator (i.e., `REML`)[@viechtbauer2005] to estimate the variance of effects. We used the default weighting procedure in the `metafor` package, because the weights provided in the original paper were not accounted for. The 2014 meta-analysis [@bouri2014] did not specify the effect variance estimate used, so minor discrepancies between our estimates and the original estimates might originate from these differences in the estimation procedure.

## Results

First, we analyzed the RRs to verify the estimates in Figure 2 and found that we were able to reproduce the estimates for the different sets of studies. The original Figure 2 [@bouri2014] differentiated between the estimates from the non-DECREASE (i.e., secure) trials and the DECREASE (i.e., non-secure trials). We confirmed the estimates of the effect size and the variance for both the non-DECREASE- and the DECREASE trials, save for some minor discrepancies due to the estimation method. Table `r tab <- 1; tab` depicts the original and reproduced values for both sets of studies.

*Table `r tab`*. The original- and reproduced meta-analytic results based on the data provided in the 2014 meta-analysis.[@bouri2014]

|              |            | Risk ratio   | $\tau^2$      | Confidence interval |
|--------------|------------|---------------------|-------------------|---|
| Non-DECREASE | Original   | 1.27                   | 0.00                 | [1.01; 1.60] |
|              | Reproduced | `r round(exp(mod_clean$b), 2)`  | `r round(mod_clean$tau2, 2)`                 | `r sprintf('[%s; %s]', round(exp(mod_clean$ci.lb), 2), round(exp(mod_clean$ci.ub), 2))` |
| DECREASE     | Original   | 0.42                   | 0.29                 | [0.15; 1.23] |
|              | Reproduced | `r round(exp(mod_dirty$b), 2)` | `r round(mod_dirty$tau2, 2)` | `r sprintf('[%s; %s]', round(exp(mod_dirty$ci.lb), 2), round(exp(mod_dirty$ci.ub), 2))` |

```{r, echo = FALSE}
mod_mods <- metafor::rma(yi = ln_rr,
             sei = se_ln_rr,
             mod =~ as.factor(decrease), # 1 are the decrease studies
             method = "REML",
             data = bouri_data,
             weighted = TRUE)
```

Second, we meta-analyzed all studies combined, including a dummy-predictor for the DECREASE and non-DECREASE studies to replicate results presented in Figure 4 of the 2014 meta-analysis.[@bouri2014] Oddly enough our reproduced results deviated more from the asssumption that the subgroups are in fact from the same population; whereas the original test for subgroup differences was $\chi^2(1)=3.91,p=.05$, our reproduced analyses indicated that $\chi^2(1)=`r round(mod_mods$QM, 2)`,p=`r round(mod_mods$QMp, 3)`$. Additionally, the original analyses showed substantial heterogeneity ($I^2=74.4$%), but our reproduced analyses showed no such thing ($I^2=`r round(mod_mods$I2, 3)`$%). Different estimates of the heterogeneity (e.g., DerSimonian-Laird instead of `REML`) did not change this difference. 

<!--- Emailed bouri about this on 2016 03 16--->

# Step 2: evaluating the veracity of DECREASE studies

We estimated the probability of the results in the DECREASE studies based on the estimates from the non-DECREASE studies. In order to do this, we assumed that the non-DECREASE studies provide the best known representation of the true effect of beta-blockers on perioperative mortality. This probability is also known as the veracity of the data [@peters2015], which indicates the probability of the observed data in a random sampling context. We assumed to estimate the true population distribution of effects, not perturbed by publication bias due to statistical significance, because a substantial number of nonsignificant effects are included in the dataset. To estimate the true population effect we only used the non-DECREASE studies.

## Method

```{r, echo = FALSE}
mod_clean_pred <- predict(mod_clean)
```

Based on the estimated mean log RR and credible interval in the non-DECREASE studies, we computed the probability of log RR in the DECREASE trials. The estimates of the non-DECREASE studies were obtained from step 1, which include the estimated log RR (i.e., `r round(mod_clean$b, 2)`), and the 95% credibility interval as provided by the package `metafor` (i.e., `r sprintf('[%s; %s]', round(mod_clean_pred$cr.lb, 3), round(mod_clean_pred$cr.ub, 3))`. We assumed a normal distribution of population effects with the estimated effect as the mean of the distribution. The 95% credibility interval denotes the bounds of the normal distribution that covers 95% of the density, where the standard deviation is calculated as the distance from the mean to either bound, divided by 1.96. This allows for an approximation of the population effect distribution, as depicted in Figure `r fig <- 1; fig`. 

*Figure `r fig`*. Density plot of the estimated true effect distribution, with the position of the DECREASE studies highlighted.
```{r, echo = FALSE}
temp <- seq(-3, 3, .001)

# pdf('../figures/fig1', width = 8, height = 6)
# use http://pdf2png.com/ when preparing manuscript
# for high quality plots
par(mar = c(.5,0,0,0))
plot(x = temp,
     dnorm(x = temp,
      mod_clean$b,
      (mod_clean_pred$pred - mod_clean_pred$cr.lb)/1.96),
     type = 'l',
     bty = 'n',
     xaxt = 'n',
     yaxt = 'n',
     xlab = '',
     ylab = '')

points(x = bouri_data$ln_rr[bouri_data$decrease == 1][1], y = 0)
text(x = bouri_data$ln_rr[bouri_data$decrease == 1][1],
     y = .15,
     labels = 'DECREASE-I',
     cex = .8)

points(x = bouri_data$ln_rr[bouri_data$decrease == 1][2], y = 0)
text(x = bouri_data$ln_rr[bouri_data$decrease == 1][2],
     y = -.1,
     labels = 'DECREASE-IV',
     cex = .8)

# dev.off()
```

Based on the estimated effect distribution from the non-DECREASE trials, we calculated the probability of each DECREASE trial or a more extreme result. In other words, we computed the *p*-value for the hypothesis that the DECREASE studies occurred based on the information available from the other trials. 

## Results

```{r, echo = FALSE}
prob <- pnorm(q = bouri_data$ln_rr[bouri_data$decrease == 1],
      mod_clean_pred$pred,
      (mod_clean_pred$pred - mod_clean_pred$cr.lb)/1.96) * 2
```

As Figure `r fig` already indicates, the DECREASE trials are highly unlikely under the estimated effect distribution based on the non-DECREASE trials. More specifically, DECREASE-I (or more extreme) has a probability of `r prob[1]` (much less than 1 in a quintillion) and DECREASE-IV `r prob[2]` (3 in a billion), which indicates they are unlikely to come from the same population effect distribution. Observing two of such extremely unlikely studies in this population effect distribution is then almost impossible, `r prob[1]*prob[2]`. This would therefore indicate that the DECREASE trials are severely different from the non-DECREASE studies.

# Step 3: estimating the amount of fabricated data

We estimate the number of data points fabricated in each DECREASE study individually (I and IV), if we were to assume data fabrication occurred. This step is carried out regardless of the results of step 2. This provides an indication of the severity of the data fabrication as concluded by the misconduct reports [@commissie2011;@commissie2012;@commissie2013;@bouri2014].

We first estimate the mortality probability in each condition (beta-blocker and control), for both the DECREASE- and non-DECREASE studies separately. To this end, we run four meta-analyses to estimate the ln(odds) of mortality per stratum. We apply the same methods as in step 1 to meta-analyze the individual effects (i.e., metafor package, REML random effects estimate, credible intervals). This results in eight meta-analyses to estimate the log odds. These separate analyses are necessary, because step 1 only provides an estimate of the overall risk ratio, but not of the odds that an event occurs conditional on exposure (beta-blocker or control) and study set (DECREASE- versus non-DECREASE). 

The log odds per study are calculated for each condition. For example, for the control condition, based on Table 1, it is calculated as

$ln(odds)=ln(\frac{c/(a+c)}{1-(c/(a+c))})$

accompanied by the standard error 

$se_{ln(odds)}=\frac{1}{(a+c)(c/(a+c))(1-(c/(a+c)))}$

For the beta-blocker condition *c* is replaced by *d*, and *a* is replaced by *b*. If there are no events in that condition (i.e., zero-count), a half is added to each cell (see also Step 1).[@agresti2002] Subsequently, meta-analyses are conducted per condition (beta-blocker and control), for both the DECREASE- and non-DECREASE studies separately. 

We apply the inversion method to estimate the number of data points fabricated in the DECREASE studies. To this end, we assume that the DECREASE data are in fact fabricated, opposed to Step 2 where we assumed they were genuine. The inversion method iteratively simulates data where *X* data points in that study are fabricated, where *X* varies from 0 through *N*. Each simulated sample is based on the effect distributions estimated earlier. This procedure is carried out for both DECREASE I and DECREASE IV. The analysis script will be made publicly available, and we include the step-by-step process here.

1. Take the entire sample from one DECREASE study, with the prespecified group sizes from that DECREASE study (e.g., 49 controls and 51 patients on beta-blockers, N=100). 
2. Randomly assign X={0, 1, 2, … , N} of the data points to be fabricated. 
3. Draw an ln(odds) from the corresponding estimated effect distribution (i.e., fabricated/genuine control/beta-blocker condition). 
4. Sample an event with the probability calculated from the ln(odds) from the previous step and note the data point 0 (no event) or 1 (event). 
5. When all data points have been generated, estimate the ln(RR) in this simulated sample with `metafor` and `REML` estimation.
6. Note whether this ln(RR) is more likely under the non-DECREASE effect distribution (coded 0) or under the DECREASE effect distribution (coded 1), based on two-sided p-values (larger p-value is more probable) from the estimated effect distributions
7. Repeat k times (k = number of iterations; these have yet to be determined but will be at least 1,000)
8. Calculate proportions of iterations where estimate was more likely under fabrication than under genuine data.
9. Note for how many data points from the fabricated (DECREASE) distribution the proportion is closest to .025 and .975 to provide a 95% confidence interval of data points fabricated.

### Checklist

1. Calculate the ln(odds) per condition for both non-DECREASE and DECREASE studies.
2. Calculate the standard error of the ln(odds) per effect.
3. Compute the four meta-analyses to estimate the ln(odds) and credible intervals for each of the 2 (beta-blocker; control) by 2 (non-DECREASE; DECREASE) design.
4. Create function to apply inversion method.
5. Apply inversion method to both DECREASE studies separately.

# Discussion

# References